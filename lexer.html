<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        *{
            margin:0;
            padding: 0;
        }
        div{
            font-size: 15px;
            color: #000;
        }
        pre{
            font-size: 25px;
        }
        h1{
            text-align: center;
            margin:20px;
        }
        .container{
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .column{
            display: flex;
            flex-direction:column;
            width: 18%;
            margin-bottom: 20px;
            margin-right: 10px;
            opacity:0;
            transition: all .5s;
        }
        .row{
            display: flex;
            flex:1;
            align-items:center;
            justify-content:center;
            border-bottom: 1px solid #eee;
            height:50px;
            font-size: 25px;
        }
        .column.active{
            opacity:1;
        }
    </style>
</head>
<body>
<h1>Regular词法解析过程</h1>
<script src="./dist/regular.js"></script>
<script>
    var tokens = [ { type: 'OPEN', value: 'if', pos: 0, state: 'JST' },
        { type: 'IDENT', value: 'user', pos: 5, state: 'JST' },
        { type: '.', value: '.', pos: 9, state: 'JST' },
        { type: 'IDENT', value: 'name', pos: 10, state: 'JST' },
        { type: 'END', pos: 14, state: 'INIT' },
        { type: 'TEXT', value: '\n  hello, ', pos: 15, state: 'TAG' },
        { type: 'TAG_OPEN', value: 'strong', pos: 25, state: 'TAG' },
        { type: '>', value: '>', pos: 32, state: 'INIT' },
        { type: 'TEXT', value: ' ', pos: 33, state: 'JST' },
        { type: 'EXPR_OPEN', escape: false, pos: 34, state: 'JST' },
        { type: 'IDENT', value: 'user', pos: 35, state: 'JST' },
        { type: '.', value: '.', pos: 39, state: 'JST' },
        { type: 'IDENT', value: 'name', pos: 40, state: 'JST' },
        { type: 'END', pos: 44, state: 'INIT' },
        { type: 'TEXT', value: ' ', pos: 45, state: 'TAG' },
        { type: 'TAG_CLOSE', value: 'strong', pos: 46, state: 'INIT' },
        { type: 'TEXT', value: ' ', pos: 55, state: 'TAG' },
        { type: 'TAG_OPEN', value: 'a', pos: 56, state: 'TAG' },
        { type: 'NAME', value: 'href', pos: 59, state: 'TAG' },
        { type: '=', value: '=', pos: 63, state: 'TAG' },
        { type: 'STRING',
            value: 'javascript:void(0)',
            pos: 64,
            state: 'TAG' },
        { type: 'NAME', value: 'on-click', pos: 85, state: 'TAG' },
        { type: '=', value: '=', pos: 93, state: 'TAG' },
        { type: 'EXPR_OPEN', escape: false, pos: 94, state: 'JST' },
        { type: 'IDENT', value: 'this', pos: 95, state: 'JST' },
        { type: '.', value: '.', pos: 99, state: 'JST' },
        { type: 'IDENT', value: 'logout', pos: 100, state: 'JST' },
        { type: '(', value: '(', pos: 106, state: 'JST' },
        { type: ')', value: ')', pos: 107, state: 'JST' },
        { type: 'END', pos: 108, state: 'TAG' },
        { type: '>', value: '>', pos: 109, state: 'INIT' },
        { type: 'TEXT', value: '登出', pos: 110, state: 'TAG' },
        { type: 'TAG_CLOSE', value: 'a', pos: 112, state: 'INIT' },
        { type: 'TEXT', value: '\n', pos: 116, state: 'JST' },
        { type: 'OPEN', value: 'else', pos: 117, state: 'JST' },
        { type: 'END', pos: 123, state: 'INIT' },
        { type: 'TEXT', value: '\n  ', pos: 124, state: 'TAG' },
        { type: 'TAG_OPEN', value: 'a', pos: 127, state: 'TAG' },
        { type: 'NAME', value: 'href', pos: 130, state: 'TAG' },
        { type: '=', value: '=', pos: 134, state: 'TAG' },
        { type: 'STRING',
            value: 'javascript:void(0)',
            pos: 135,
            state: 'TAG' },
        { type: 'NAME', value: 'on-click', pos: 156, state: 'TAG' },
        { type: '=', value: '=', pos: 164, state: 'TAG' },
        { type: 'EXPR_OPEN', escape: false, pos: 165, state: 'JST' },
        { type: 'IDENT', value: 'this', pos: 166, state: 'JST' },
        { type: '.', value: '.', pos: 170, state: 'JST' },
        { type: 'IDENT', value: 'login', pos: 171, state: 'JST' },
        { type: '(', value: '(', pos: 176, state: 'JST' },
        { type: ')', value: ')', pos: 177, state: 'JST' },
        { type: 'END', pos: 178, state: 'TAG' },
        { type: '>', value: '>', pos: 179, state: 'INIT' },
        { type: 'TEXT', value: '登入', pos: 180, state: 'TAG' },
        { type: 'TAG_CLOSE', value: 'a', pos: 182, state: 'INIT' },
        { type: 'TEXT', value: '\n', pos: 186, state: 'JST' },
        { type: 'CLOSE', value: 'if', pos: 187, state: 'INIT' },
        { type: 'EOF' } ]

</script>
<script>
    var template = `
{#if user.name}
  hello, <strong> {user.name} </strong> <a href="javascript:void(0)" on-click={this.logout()}>登出</a>
{#else}
  <a href="javascript:void(0)" on-click={this.login()}>登入</a>
{/if}
`;
    var last = 0;
    var View = Regular.extend({
        data: {
            tokens: tokens,
            txt: template,
            last: 0,
            backgrounds:['blue','yellow','white']
        },
        template:`
            <pre>
{txt}
            </pre>
            <div class="container">
            {#list tokens as token}
                <div class="column {token.active==1?'active':''}" style="background: {this.getColor(token)};">
                    <div class="row">{this.getText(token, token_index)}</div>
                    <div class="row">{token.type}</div>
                    <div class="row">{token.value}</div>
                    <div class="row">{token.pos}</div>
                </div>
            {/list}
</div>
        `,
        getText: function (token, token_index) {
            var tokens = this.data.tokens;
            var nextToken = tokens[token_index+1]
            if( nextToken ) {
                return template.substring(token.pos+1,nextToken.pos? (nextToken.pos+1):(template.length-1));
            }
            return '';
        },
        getColor: function (token) {
            if(!token.color){
                var color = this.data.backgrounds;
                var len = color.length-1;
                token.color = color[Math.round(Math.random() * len)];
            }
            return token.color;
        },
        init: function () {
            var tokens = this.data.tokens;
            var i = 0;
            setInterval(function () {
                if(i>=tokens.length){
                    return -1;
                }
                tokens[i++].active = true;
                this.$update();
            }.bind(this),500);
        }
    });
    new View().$inject(document.body);
</script>
</body>
</html>
